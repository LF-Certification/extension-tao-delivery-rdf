{"version":3,"mappings":"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","names":["define","start","$","urlUtil","target","current","timeout","$search","$list","liveSearch","clearTimeout","filterList","list","excluded","url","type","data","uri","dataType","success","response","feedback","section","listTests","q","page","done","tests","resolve","reject","fail","actionManager","createSelectorInput","$filterContainer","$inputElement","taskButton","dataProvider","inputPlaceholder","inputLabel","placeholder","label","width","quietMillis","on","selection","params","then","catch","render","replaceSubmitWithTaskButton","$form","$reportContainer","buttonTitle","buttonLabel","$oldSubmitter","taskCreationButton","icon","title","taskQueue","taskCreationUrl","taskCreationData","taskReportContainer","result","_","refreshTree","disable","setupTaoLocalForm","deliveryFormHelper","$container","testUri","testLabel","resourceProvider","destinationSelectorFactory","actionName","classUri","getResources","self","button","err"],"sources":["css!taoDeliveryRdfCss/delivery-rdf","../controller/DeliveryMgmt/editDelivery.js","../controller/DeliveryMgmt/testtaker.js","../util/providers/testsProvider.js","../util/forms/deliveryFormHelper.js","../controller/DeliveryMgmt/wizard.js","../controller/Publish/index.js","../controller/routes.js","onLayerEnd0.js","module-create.js"],"sourcesContent":["\ndefine('css!taoDeliveryRdfCss/delivery-rdf',[],function(){});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013-2019 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDeliveryRdf/controller/DeliveryMgmt/editDelivery',[\n    'jquery',\n    'util/url',\n    'ui/modal',\n    'css!taoDeliveryRdfCss/delivery-rdf.css'\n], function ($, urlUtil) {\n    'use strict';\n\n    return {\n        start(){\n            $('#exclude-btn').click(function() {\n                const delivery = $(this).data('delivery');\n\n                $('#testtaker-form').load(\n                    urlUtil.route('excludeTesttaker', 'DeliveryMgmt', 'taoDeliveryRdf', {'uri' : delivery}),\n                    () => {\n                        $('body').prepend($('#modal-container'));\n                        $('#testtaker-form').modal();\n                    }\n                );\n            });\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDeliveryRdf/controller/DeliveryMgmt/testtaker',['jquery', 'i18n', 'helpers', 'module', 'layout/section', 'ui/feedback'], \nfunction ($, __, helpers, module, section, feedback) {\n    'use strict';\n\n\tfunction switchList() {\n\t\tvar current = $(this).parent().attr('id');\n        var target; \n\t\tif (current == 'excludedList') {\n\t\t\ttarget = $('#assignedList'); \n\t\t} else if (current == 'assignedList') {\n\t\t\ttarget = $('#excludedList');\n\t\t}\n\t\tif (typeof target !== 'undefined') {\n\t\t\ttarget.append(this);\n\t\t\tthis.scrollIntoView();\n\t\t}\n\t}\n\t\n\tvar $search = $('#tt-filter');\n    var $list   = $('#assignedList');\n    var timeout;\n    \n    var liveSearch = function(){\n        var pattern = $search.val();\n        clearTimeout(timeout);\n        timeout = setTimeout(function(){\n        \tfilterList(new RegExp(pattern), $list);\n        }, 300);\n    };\n    \n    var filterList = function(regex, list) {\n    \tlist.children().each(function(index, element) {\n    \t\tif ($(element).text().match(regex) === null) {\n    \t\t\t$(element).hide();\n    \t\t} else {\n    \t\t\t$(element).show();\n    \t\t}\n    \t});\n    };\n\t\n    return {\n        start : function(){\n\t        $('#save-tt').click(function() {\n\t        \tvar excluded = [];\n\t        \t$('#excludedList > li').each(function(index) {\n\t        \t\texcluded.push($(this).data('uri'));\n\t        \t});\n\t        \tvar assemblyUri = $('input[name=\"assemblyUri\"]').val();\n\t        \t$.ajax({\n\t        \t\turl: helpers._url('saveExcluded', 'DeliveryMgmt', 'taoDeliveryRdf'),\n\t\t\t\t\ttype: \"POST\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\turi: assemblyUri,\n\t\t\t\t\t\texcluded: JSON.stringify(excluded)\n\t\t\t\t\t},\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\tsuccess: function(response) {\n\t\t\t\t\t\tif (response.saved) {\n                            feedback().success(__('Selection saved successfully'));\n                            section.loadContentBlock(helpers._url('editDelivery', 'DeliveryMgmt', 'taoDeliveryRdf'), {uri: assemblyUri});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t        });\n        \t$('#assignedList > li').click(switchList);\n        \t$('#excludedList > li').click(switchList);\n        \t\n        \t$('#close-tt').click(function() {\n        \t\t$('#testtaker-form').modal('close');\n        \t});\n                \n            //trigger the search on keyp and on the magnifer button click\n            $search.keyup(liveSearch).siblings('.ctrl').click(liveSearch);\n        \t\n        }\n    };\n});\n\n\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2019 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\n/**\n * @author Martin Nicholson <martin@taotesting.com>\n */\ndefine('taoDeliveryRdf/util/providers/testsProvider',[\n    'jquery',\n    'i18n',\n    'util/url'\n], function ($, __, urlUtils) {\n    'use strict';\n\n    var providers = {\n        /**\n         * List available tests\n         * @param {Object} data\n         * @returns {Promise}\n         */\n        listTests(data) {\n            return new Promise(function (resolve, reject) {\n                $.ajax({\n                    url: urlUtils.route('getAvailableTests', 'DeliveryMgmt', 'taoDeliveryRdf'),\n                    data: {\n                        q: data.q,\n                        page: data.page\n                    },\n                    type: 'GET',\n                    dataType: 'JSON'\n                }).done(function (tests) {\n                    if (tests) {\n                        resolve(tests);\n                    } else {\n                        reject(new Error(__('Unable to load tests')));\n                    }\n                }).fail(function () {\n                    reject(new Error(__('Unable to load tests')));\n                });\n            });\n        }\n    };\n\n    return providers;\n\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2019 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\n/**\n * @author Martin Nicholson <martin@taotesting.com>\n */\ndefine('taoDeliveryRdf/util/forms/deliveryFormHelper',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'ui/filter',\n    'ui/feedback',\n    'layout/actions',\n    'ui/taskQueue/taskQueue',\n    'ui/taskQueueButton/standardButton'\n], function ($, _, __, filterFactory, feedback, actionManager, taskQueue, taskCreationButtonFactory) {\n    'use strict';\n\n    /**\n     * wrapped the old jstree API used to refresh the tree and optionally select a resource\n     * @param {String} [uriResource] - the uri resource node to be selected\n     */\n    const refreshTree = function refreshTree(uriResource){\n        actionManager.trigger('refresh', {\n            uri : uriResource\n        });\n    };\n\n    return {\n        /**\n         * Enhances a hidden form field, rendering a text input with filter, autocomplete and dropdown\n         * @param {Object} options\n         * @param {jQuery} options.$filterContainer\n         * @param {jQuery} options.$inputElement\n         * @param {taskQueueButton} options.taskButton - button which submits the form\n         * @param {Function} options.dataProvider - provider function which returns a Promise\n         * @param {String} options.inputPlaceholder\n         * @param {String} options.inputLabel\n         * @returns {filter} component which manages the form input\n         */\n        createSelectorInput({\n            $filterContainer,\n            $inputElement,\n            taskButton,\n            dataProvider,\n            inputPlaceholder = __('Select the test you want to publish to the test-takers'),\n            inputLabel = __('Select the test')\n        }) {\n            return filterFactory($filterContainer, {\n                placeholder: inputPlaceholder,\n                label: inputLabel,\n                width: '64%',\n                quietMillis: 1000\n            })\n            .on('change', function(selection) {\n                $inputElement.val(selection);\n                if (selection) {\n                    taskButton.enable();\n                } else {\n                    taskButton.disable();\n                }\n            })\n            .on('request', function(params) {\n                dataProvider\n                    .list(params.data)\n                    .then(function(data) {\n                        params.success(data);\n                    })\n                    .catch(function(err) {\n                        params.error(err);\n                        feedback().error(err);\n                    });\n            })\n            .render('<%- text %>');\n        },\n\n        /**\n         * Replaces rendered submit input with a button that sends a task to taskQueue over AJAX\n         * @param {Object} options\n         * @param {jQuery} options.$form\n         * @param {jQuery} options.$reportContainer\n         * @param {Object} options.buttonTitle\n         * @param {Object} options.buttonLabel\n         * @returns {taskQueueButton}\n         */\n        replaceSubmitWithTaskButton({\n            $form,\n            $reportContainer,\n            buttonTitle = __('Publish the test'),\n            buttonLabel = __('Publish')\n        }) {\n            //find the old submitter\n            const $oldSubmitter = $form.find('.form-submitter');\n            //prepare the new component\n            const taskCreationButton = taskCreationButtonFactory({\n                type : 'info',\n                icon : 'delivery',\n                title : buttonTitle,\n                label : buttonLabel,\n                taskQueue : taskQueue,\n                taskCreationUrl : $form.prop('action'),\n                taskCreationData : function getTaskCreationData(){\n                    return $form.serializeArray();\n                },\n                taskReportContainer : $reportContainer\n            })\n            .on('finished', function(result){\n                if (result\n                    && result.task\n                    && result.task.report\n                    && _.isArray(result.task.report.children)\n                    && result.task.report.children.length\n                    && result.task.report.children[0]) {\n                    if(result.task.report.children[0].data\n                        && result.task.report.children[0].data.uriResource){\n                        feedback().info(__('%s completed', result.task.taskLabel), { encodeHtml: false });\n                        refreshTree(result.task.report.children[0].data.uriResource);\n                    }else{\n                        this.displayReport(result.task.report.children[0], __('Error'));\n                    }\n                }\n            })\n            .on('continue', function(){\n                refreshTree();\n            })\n            .on('error', function(err){\n                //format and display error message to user\n                feedback().error(err);\n                this.trigger('finished');\n            })\n            .render($oldSubmitter.closest('.form-toolbar'))\n            .disable();\n\n            //replace the old submitter with the new one\n            $oldSubmitter.replaceWith(taskCreationButton.getElement());\n\n            return taskCreationButton;\n        },\n\n        /**\n         * Set up the wizard form for publishing a TAO Local delivery\n         * @param {jQuery} $form\n         * @param {Object} providers - contains function(s) for fetching data\n         */\n        setupTaoLocalForm($form, providers) {\n            const $reportContainer = $form.closest('.content-block');\n            const $filterContainer = $('.test-select-container', $form);\n            const $inputElement = $('#test', $form);\n\n            // Replace submit button with taskQueue requester\n            const taskButton = this.replaceSubmitWithTaskButton({\n                $form,\n                $reportContainer\n            });\n\n            // Enhanced selector input for tests:\n            this.createSelectorInput({\n                $filterContainer,\n                $inputElement,\n                taskButton,\n                dataProvider: {\n                    list: providers.listTests\n                }\n            });\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2019 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\n/**\n * @author Martin Nicholson <martin@taotesting.com>\n */\ndefine('taoDeliveryRdf/controller/DeliveryMgmt/wizard',[\n    'jquery',\n    'taoDeliveryRdf/util/providers/testsProvider',\n    'taoDeliveryRdf/util/forms/deliveryFormHelper',\n    'css!taoDeliveryRdfCss/delivery-rdf.css'\n], function ($, testsProvider, deliveryFormHelper) {\n    'use strict';\n\n    return {\n        start() {\n            const $form = $('#simpleWizard');\n            deliveryFormHelper.setupTaoLocalForm($form, testsProvider);\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2018 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\ndefine('taoDeliveryRdf/controller/Publish/index',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'util/url',\n    'layout/actions',\n    'provider/resources',\n    'ui/destination/selector',\n    'ui/feedback',\n    'ui/taskQueue/taskQueue'\n], function ($, _, __, urlHelper, actionManager, resourceProviderFactory, destinationSelectorFactory, feedback, taskQueue) {\n    'use strict';\n\n    /**\n     * wrapped the old jstree API used to refresh the tree and optionally select a resource\n     * @param {String} [uriResource] - the uri resource node to be selected\n     */\n    var refreshTree = function refreshTree(uriResource){\n        actionManager.trigger('refresh', {\n            uri : uriResource\n        });\n    };\n\n    return {\n        start : function start() {\n\n            var $container = $('.selector-container');\n            var testUri = $container.data('test');\n            var testLabel = $container.data('label');\n\n            //get the resource provider configured with the action URL\n            var resourceProvider = resourceProviderFactory();\n\n            //set up a destination selector\n            destinationSelectorFactory($container, {\n                title : __('Publish \"%s\" to', testLabel),\n                actionName : __('Publish'),\n                icon : 'delivery',\n                taskQueue : taskQueue,\n                taskCreationData : {testUri : testUri},\n                taskCreationUrl : urlHelper.route('publish', 'Publish', 'taoDeliveryRdf'),\n                classUri: $container.data('root-class')\n            })\n            .on('query', function(params) {\n                var self = this;\n\n                //asks only classes\n                params.classOnly = true;\n                resourceProvider\n                    .getResources(params, true)\n                    .then(function(resources){\n                        //ask the server the resources from the component query\n                        self.update(resources, params);\n                    })\n                    .catch(function(err){\n                        self.trigger('error', err);\n                    });\n            })\n            .on('finished', function (result, button) {\n                if (result.task\n                    && result.task.report\n                    && _.isArray(result.task.report.children)\n                    && result.task.report.children.length\n                    && result.task.report.children[0]) {\n                    if (result.task.report.children[0].data\n                        && result.task.report.children[0].data.uriResource) {\n                        feedback().info(__('%s completed', result.task.taskLabel), { encodeHtml: false });\n\n                        //TODO: redirect to the newly compiled delivery when TAO-5746 is merged\n                        refreshTree(result.task.report.children[0].data.uriResource);\n                    } else {\n                        button.displayReport(result.task.report.children[0], __('Error'));\n                    }\n                }\n            })\n            .on('continue', function(){\n                refreshTree(testUri);\n            })\n            .on('error', function(err){\n                if (err && err.errorMsg) {\n                    err = err.errorMsg;\n                }\n                feedback().error(err);\n            });\n        }\n    };\n});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2017 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoDeliveryRdf/controller/routes',[],function(){\n    'use strict';\n\n    return {\n        'DeliveryMgmt': {\n            'actions' : {\n                'editDelivery'     : 'controller/DeliveryMgmt/editDelivery',\n                'excludeTesttaker' : 'controller/DeliveryMgmt/testtaker',\n                'wizard'           : 'controller/DeliveryMgmt/wizard'\n            }\n        },\n        'Publish': {\n            'actions' : {\n                'index' : 'controller/Publish/index'\n            }\n        }\n    };\n});\n\n","\n(function(c){var d=document,a='appendChild',i='styleSheet',s=d.createElement('style');s.type='text/css';d.getElementsByTagName('head')[0][a](s);s[i]?s[i].cssText=c:s[a](d.createTextNode(c));})\n('.delivery-headings h3{margin-bottom:5px}.delivery-headings h2{margin-bottom:5px}.delivery-headings .label{font-weight:bold}.delivery-headings .label:not(:first-child){margin-left:1em}.xhtml_form .form-toolbar .loading-button{float:right}.ttlist{overflow:auto}.ttlist li{cursor:pointer;border-bottom:1px solid #ddd;padding:3px;background:#f9f8f7}.ttlist li:hover{color:white;background:rgba(14,93,145,0.8)}.filter-div{text-align:right;position:relative;background:#ddd;padding:1px}.filter-div input{display:block;width:calc(100% - 14px);padding:6px;font-size:14px;font-size:1.4rem;max-width:none}.filter-div span{position:absolute;right:10px;top:8px;opacity:.3}#assignedList,#excludedList{height:267px;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px}#assignedList li,#excludedList li{line-height:1.4}#assignedList li .arrow:before,#excludedList li .arrow:before{font-family:\\'tao\\' !important;speak:never;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:\\\"\\\\e60f\\\"}#assignedList li .arrow{float:right;margin-right:5px}#excludedList{margin-top:43px}#excludedList li .arrow{float:left;margin-left:5px;margin-right:10px}\\n\\n/*# sourceMappingURL=../../../taoDeliveryRdf/views/css/delivery-rdf.css.map */');\n","\ndefine(\"taoDeliveryRdf/loader/taoDeliveryRdf.bundle\", function(){});\n"]}