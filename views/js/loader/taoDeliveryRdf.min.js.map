{"version":3,"sources":["../controller/DeliveryMgmt/editDelivery.js","../controller/DeliveryMgmt/testtaker.js","../controller/DeliveryMgmt/wizard.js","../controller/Publish/index.js","../controller/routes.js","module-create.js"],"names":[],"mappings":"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","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013-2019 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDeliveryRdf/controller/DeliveryMgmt/editDelivery',[\n    'jquery',\n    'util/url',\n    'ui/modal'\n], function ($, urlUtil) {\n    'use strict';\n\n    return {\n        start(){\n            $('#exclude-btn').click(function() {\n                const delivery = $(this).data('delivery');\n\n                $('#testtaker-form').load(\n                    urlUtil.route('excludeTesttaker', 'DeliveryMgmt', 'taoDeliveryRdf', {'uri' : delivery}),\n                    () => {\n                        $('body').prepend($('#modal-container'));\n                        $('#testtaker-form').modal();\n                    }\n                );\n            });\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDeliveryRdf/controller/DeliveryMgmt/testtaker',['jquery', 'i18n', 'helpers', 'module', 'layout/section', 'ui/feedback'], \nfunction ($, __, helpers, module, section, feedback) {\n    'use strict';\n\n\tfunction switchList() {\n\t\tvar current = $(this).parent().attr('id');\n        var target; \n\t\tif (current == 'excludedList') {\n\t\t\ttarget = $('#assignedList'); \n\t\t} else if (current == 'assignedList') {\n\t\t\ttarget = $('#excludedList');\n\t\t}\n\t\tif (typeof target !== 'undefined') {\n\t\t\ttarget.append(this);\n\t\t\tthis.scrollIntoView();\n\t\t}\n\t}\n\t\n\tvar $search = $('#tt-filter');\n    var $list   = $('#assignedList');\n    var timeout;\n    \n    var liveSearch = function(){\n        var pattern = $search.val();\n        clearTimeout(timeout);\n        timeout = setTimeout(function(){\n        \tfilterList(new RegExp(pattern), $list);\n        }, 300);\n    };\n    \n    var filterList = function(regex, list) {\n    \tlist.children().each(function(index, element) {\n    \t\tif ($(element).text().match(regex) === null) {\n    \t\t\t$(element).hide();\n    \t\t} else {\n    \t\t\t$(element).show();\n    \t\t}\n    \t});\n    };\n\t\n    return {\n        start : function(){\n\t        $('#save-tt').click(function() {\n\t        \tvar excluded = [];\n\t        \t$('#excludedList > li').each(function(index) {\n\t        \t\texcluded.push($(this).data('uri'));\n\t        \t});\n\t        \tvar assemblyUri = $('input[name=\"assemblyUri\"]').val();\n\t        \t$.ajax({\n\t        \t\turl: helpers._url('saveExcluded', 'DeliveryMgmt', 'taoDeliveryRdf'),\n\t\t\t\t\ttype: \"POST\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\turi: assemblyUri,\n\t\t\t\t\t\texcluded: JSON.stringify(excluded)\n\t\t\t\t\t},\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\tsuccess: function(response) {\n\t\t\t\t\t\tif (response.saved) {\n                            feedback().success(__('Selection saved successfully'));\n                            section.loadContentBlock(helpers._url('editDelivery', 'DeliveryMgmt', 'taoDeliveryRdf'), {uri: assemblyUri});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t        });\n        \t$('#assignedList > li').click(switchList);\n        \t$('#excludedList > li').click(switchList);\n        \t\n        \t$('#close-tt').click(function() {\n        \t\t$('#testtaker-form').modal('close');\n        \t});\n                \n            //trigger the search on keyp and on the magnifer button click\n            $search.keyup(liveSearch).siblings('.ctrl').click(liveSearch);\n        \t\n        }\n    };\n});\n\n\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2019 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\ndefine('taoDeliveryRdf/controller/DeliveryMgmt/wizard',[\n    'lodash',\n    'jquery',\n    'i18n',\n    'ui/filter',\n    'ui/feedback',\n    'util/url',\n    'layout/actions',\n    'core/promise',\n    'ui/taskQueue/taskQueue',\n    'ui/taskQueueButton/standardButton'\n], function (_, $, __, filterFactory, feedback, urlUtils, actionManager, Promise, taskQueue, taskCreationButtonFactory) {\n    'use strict';\n\n    var provider = {\n\n        /**\n         * List available tests\n         * @returns {Promise}\n         */\n        list: function list(data) {\n            return new Promise(function (resolve, reject) {\n                $.ajax({\n                    url: urlUtils.route('getAvailableTests', 'DeliveryMgmt', 'taoDeliveryRdf'),\n                    data: {\n                        q: data.q,\n                        page: data.page\n                    },\n                    type: 'GET',\n                    dataType: 'JSON'\n                }).done(function (tests) {\n                    if (tests) {\n                        resolve(tests);\n                    } else {\n                        reject(new Error(__('Unable to load tests')));\n                    }\n                }).fail(function () {\n                    reject(new Error(__('Unable to load tests')));\n                });\n            });\n        }\n    };\n\n    /**\n     * wrapped the old jstree API used to refresh the tree and optionally select a resource\n     * @param {String} [uriResource] - the uri resource node to be selected\n     */\n    var refreshTree = function refreshTree(uriResource){\n        actionManager.trigger('refresh', {\n            uri : uriResource\n        });\n    };\n\n    return {\n        start: function () {\n            var $filterContainer = $('.test-select-container');\n            var $formElement = $('#test');\n            var $form = $('#simpleWizard');\n            var $container = $form.closest('.content-block');\n            var taskCreationButton, $oldSubmitter;\n\n            filterFactory($filterContainer, {\n                placeholder: __('Select the test you want to publish to the test-takers'),\n                width: '64%',\n                quietMillis: 1000,\n                label: __('Select the test')\n            }).on('change', function (test) {\n                $formElement.val(test);\n                if(test){\n                    taskCreationButton.enable();\n                }else{\n                    taskCreationButton.disable();\n                }\n            }).on('request', function (params) {\n                provider\n                    .list(params.data)\n                    .then(function (tests) {\n                        params.success(tests);\n                    })\n                    .catch(function (err) {\n                        params.error(err);\n                        feedback().error(err);\n                    });\n            }).render('<%- text %>');\n\n            //find the old submitter and replace it with the new component\n            $oldSubmitter = $form.find('.form-submitter');\n            taskCreationButton = taskCreationButtonFactory({\n                type : 'info',\n                icon : 'delivery',\n                title : __('Publish the test'),\n                label : __('Publish'),\n                taskQueue : taskQueue,\n                taskCreationUrl : $form.prop('action'),\n                taskCreationData : function getTaskCreationData(){\n                    return $form.serializeArray();\n                },\n                taskReportContainer : $container\n            }).on('finished', function(result){\n                if (result.task\n                    && result.task.report\n                    && _.isArray(result.task.report.children)\n                    && result.task.report.children.length\n                    && result.task.report.children[0]) {\n                    if(result.task.report.children[0].data\n                        && result.task.report.children[0].data.uriResource){\n                        feedback().info(__('%s completed', result.task.taskLabel));\n                        refreshTree(result.task.report.children[0].data.uriResource);\n                    }else{\n                        this.displayReport(result.task.report.children[0], __('Error'));\n                    }\n                }\n            }).on('continue', function(){\n                refreshTree();\n            }).on('error', function(err){\n                //format and display error message to user\n                feedback().error(err);\n            }).render($oldSubmitter.closest('.form-toolbar')).disable();\n\n            //replace the old submitter with the new one and apply its style\n            $oldSubmitter.replaceWith(taskCreationButton.getElement().css({float: 'right'}));\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2018 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\ndefine('taoDeliveryRdf/controller/Publish/index',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'util/url',\n    'layout/actions',\n    'provider/resources',\n    'ui/destination/selector',\n    'ui/feedback',\n    'ui/taskQueue/taskQueue'\n], function ($, _, __, urlHelper, actionManager, resourceProviderFactory, destinationSelectorFactory, feedback, taskQueue) {\n    'use strict';\n\n    /**\n     * wrapped the old jstree API used to refresh the tree and optionally select a resource\n     * @param {String} [uriResource] - the uri resource node to be selected\n     */\n    var refreshTree = function refreshTree(uriResource){\n        actionManager.trigger('refresh', {\n            uri : uriResource\n        });\n    };\n\n    return {\n        start : function start() {\n\n            var $container = $('.selector-container');\n            var testUri = $container.data('test');\n            var testLabel = $container.data('label');\n\n            //get the resource provider configured with the action URL\n            var resourceProvider = resourceProviderFactory();\n\n            //set up a destination selector\n            destinationSelectorFactory($container, {\n                title : __('Publish \"%s\" to', testLabel),\n                actionName : __('Publish'),\n                icon : 'delivery',\n                taskQueue : taskQueue,\n                taskCreationData : {testUri : testUri},\n                taskCreationUrl : urlHelper.route('publish', 'Publish', 'taoDeliveryRdf'),\n                classUri: $container.data('root-class')\n            })\n            .on('query', function(params) {\n                var self = this;\n\n                //asks only classes\n                params.classOnly = true;\n                resourceProvider\n                    .getResources(params, true)\n                    .then(function(resources){\n                        //ask the server the resources from the component query\n                        self.update(resources, params);\n                    })\n                    .catch(function(err){\n                        self.trigger('error', err);\n                    });\n            })\n            .on('finished', function (result, button) {\n                if (result.task\n                    && result.task.report\n                    && _.isArray(result.task.report.children)\n                    && result.task.report.children.length\n                    && result.task.report.children[0]) {\n                    if (result.task.report.children[0].data\n                        && result.task.report.children[0].data.uriResource) {\n                        feedback().info(__('%s completed', result.task.taskLabel));\n\n                        //TODO: redirect to the newly compiled delivery when TAO-5746 is merged\n                        refreshTree(result.task.report.children[0].data.uriResource);\n                    } else {\n                        button.displayReport(result.task.report.children[0], __('Error'));\n                    }\n                }\n            })\n            .on('continue', function(){\n                refreshTree(testUri);\n            })\n            .on('error', function(err){\n                feedback().error(err);\n            });\n        }\n    };\n});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2017 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoDeliveryRdf/controller/routes',[],function(){\n    'use strict';\n\n    return {\n        'DeliveryMgmt': {\n            'actions' : {\n                'editDelivery'     : 'controller/DeliveryMgmt/editDelivery',\n                'excludeTesttaker' : 'controller/DeliveryMgmt/testtaker',\n                'wizard'           : 'controller/DeliveryMgmt/wizard'\n            }\n        },\n        'Publish': {\n            'actions' : {\n                'index' : 'controller/Publish/index'\n            }\n        }\n    };\n});\n\n","\ndefine(\"taoDeliveryRdf/loader/taoDeliveryRdf.bundle\", function(){});\n"]}